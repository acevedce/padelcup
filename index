<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium PadelCup 2.0 - Sistema de Gesti√≥n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 3px solid #2c5364;
            position: relative;
        }

        h1 {
            color: #0f2027;
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: #555;
            font-size: 1.2em;
            font-style: italic;
        }

        .trophy-icon {
            font-size: 1.2em;
            color: #ffd700;
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .sponsor-container {
            position: absolute;
            right: 20px;
            top: 20px;
            text-align: center;
            max-width: 150px;
        }

        .sponsor-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            margin-bottom: 5px;
        }

        .sponsor-text {
            font-size: 11px;
            color: #666;
            line-height: 1.3;
        }

        .sponsor-link {
            color: #2c5364;
            text-decoration: none;
            font-weight: bold;
        }

        .sponsor-link:hover {
            text-decoration: underline;
        }

        .setup-section {
            background: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #2a5298;
        }

        .setup-section h2 {
            color: #1e3c72;
            margin-bottom: 15px;
        }

        .setup-section ol {
            margin-left: 20px;
            line-height: 1.8;
        }

        .setup-section code {
            background: #333;
            color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background-color: #e0e0e0;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            position: relative;
            top: 2px;
        }

        .tab:hover {
            background-color: #d0d0d0;
        }

        .tab.active {
            background-color: #2c5364;
            color: white;
            top: 0;
            padding-bottom: 14px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        h2 {
            color: #2c5364;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: #203a43;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row > * {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2c5364;
            box-shadow: 0 0 0 3px rgba(44, 83, 100, 0.1);
        }

        button {
            background-color: #2c5364;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background-color: #203a43;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .btn-success {
            background-color: #28a745;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-warning {
            background-color: #ffc107;
            color: #333;
        }

        .btn-warning:hover {
            background-color: #e0a800;
        }

        .btn-danger {
            background-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 14px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #2c5364;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .connection-status {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }

        .connected {
            background-color: #28a745;
            color: white;
        }

        .disconnected {
            background-color: #dc3545;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
            font-style: italic;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .success {
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .info-box {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.2s;
        }

        .ranking-card:hover {
            transform: translateX(5px);
        }

        .ranking-position {
            font-size: 2em;
            font-weight: bold;
            color: #2c5364;
            width: 60px;
            text-align: center;
        }

        .ranking-position.gold {
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        .ranking-position.silver {
            color: #c0c0c0;
            text-shadow: 0 0 10px rgba(192, 192, 192, 0.5);
        }

        .ranking-position.bronze {
            color: #cd7f32;
            text-shadow: 0 0 10px rgba(205, 127, 50, 0.5);
        }

        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 40px;
            border-top: 1px solid #e0e0e0;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2em;
            }

            .sponsor-container {
                position: static;
                max-width: 100%;
                margin-bottom: 20px;
            }

            .tabs {
                gap: 2px;
            }

            .tab {
                padding: 10px 15px;
                font-size: 14px;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="connectionStatus" class="connection-status disconnected">Desconectado</div>
        
        <div class="header">
            <div class="sponsor-container">
                <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCACAAIADASIAAHEBAxEB/8QAGwAAAgIDAQAAAAAAAAAAAAAAAAcEBgEDBQL/xAA4EAABAwMCAwYEBQMEAwAAAAABAAIDBAUREiEGMUETIlFhcYEHFDKRQqGxwdEjUvAVJGLhcpLx/8QAGQEAAwEBAQAAAAAAAAAAAAAAAAMEAgUB/8QAIhEAAwEAAgICAwEBAAAAAAAAAAECEQMSITETQQQiUWEy/9oADAMBAAIRAxEAPwBuIQhACEIQAIQhACEIQAIQhACEIQAIQhACEIQAIQhACEIQAIQhACEIQAIQhACEZWHvaxpc5wa0cydgEAZQvnT4rfEKpvl4ls1jq5KegppzE50LtJnkachxcObQeWOFCt/G3FtBa222ivdZFS6cBpe17gPDU4E49UAdKi45Y3nGQ0HpkKaoPDNI613WGudM6SSQFhadhGQRy9lOQ/YApQEIQAIQhACEKFdblQ2ijfXXKqipqaPHaSyu0tbkgDJ9SEATFp7VvaGPUNY5jO6hWLiOw8QSTQWW5w10kDQ+RsWTo1EDJz128F2EAYQqzxNxxw7wnJBFfqs08k7S9jRG52QDg8h4FMUEEAjkUAccqt3fiayWOopqe7XGOC")
                    alt="ECAV Logo" 
                    class="sponsor-logo">
                <p class="sponsor-text">
                    Desarrollado por<br>
                    <a href="https://ecav.com.py" target="_blank" class="sponsor-link">ECAV.com.py</a>
                </p>
            </div>
            
            <h1>
                <span class="trophy-icon">üèÜ</span>
                Premium PadelCup 2.0
                <span class="trophy-icon">üèÜ</span>
            </h1>
            <p class="subtitle">Sistema de Gesti√≥n de Torneo - Edici√≥n Google Sheets</p>
        </div>

        <!-- Secci√≥n de configuraci√≥n de Google Sheets -->
        <div id="setupSection" class="setup-section">
            <h2>‚öôÔ∏è Configuraci√≥n Inicial - Google Sheets</h2>
            <p>Para usar esta aplicaci√≥n con Google Sheets como base de datos compartida, sigue estos pasos:</p>
            
            <ol>
                <li>Crea una nueva hoja de c√°lculo en Google Sheets</li>
                <li>En el men√∫, ve a <strong>Extensiones ‚Üí Apps Script</strong></li>
                <li>Borra todo el c√≥digo y pega el siguiente:</li>
            </ol>
            
            <pre style="background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0;">
<code>// ===== C√ìDIGO APPS SCRIPT PARA PREMIUM PADELCUP 2.0 =====

function doGet(e) {
  return handleRequest(e);
}

function doPost(e) {
  return handleRequest(e);
}

function handleRequest(e) {
  var spreadsheet = SpreadsheetApp.getActiveSpreadsheet();
  var action = e.parameter.action;
  var callback = e.parameter.callback;
  
  try {
    initializeSheets(spreadsheet);
    var result = {};
    
    switch(action) {
      // === CONFIGURACI√ìN ===
      case 'getConfig':
        result = getConfig(spreadsheet);
        break;
      case 'saveConfig':
        result = saveConfig(spreadsheet, e);
        break;
        
      // === PAREJAS ===
      case 'getParejas':
        result = getParejas(spreadsheet);
        break;
      case 'addPareja':
        result = addPareja(spreadsheet, e);
        break;
      case 'deletePareja':
        result = deletePareja(spreadsheet, e);
        break;
        
      // === JORNADAS ===
      case 'getJornadas':
        result = getJornadas(spreadsheet);
        break;
      case 'addJornada':
        result = addJornada(spreadsheet, e);
        break;
      case 'deleteJornada':
        result = deleteJornada(spreadsheet, e);
        break;
      case 'generarJornadas':
        result = generarJornadas(spreadsheet, e);
        break;
        
      // === PARTIDOS ===
      case 'getPartidos':
        result = getPartidos(spreadsheet);
        break;
      case 'addPartido':
        result = addPartido(spreadsheet, e);
        break;
      case 'updatePartido':
        result = updatePartido(spreadsheet, e);
        break;
      case 'deletePartido':
        result = deletePartido(spreadsheet, e);
        break;
        
      case 'test':
        result = {success: true, message: 'Conexi√≥n exitosa con Premium PadelCup 2.0'};
        break;
        
      default:
        result = {success: false, error: 'Acci√≥n no v√°lida: ' + action};
    }
    
    // Devolver JSONP si hay callback
    if (callback) {
      return ContentService
        .createTextOutput(callback + '(' + JSON.stringify(result) + ')')
        .setMimeType(ContentService.MimeType.JAVASCRIPT);
    } else {
      return ContentService
        .createTextOutput(JSON.stringify(result))
        .setMimeType(ContentService.MimeType.JSON);
    }
    
  } catch(error) {
    var errorResult = {success: false, error: error.toString(), stack: error.stack};
    if (callback) {
      return ContentService
        .createTextOutput(callback + '(' + JSON.stringify(errorResult) + ')')
        .setMimeType(ContentService.MimeType.JAVASCRIPT);
    } else {
      return ContentService
        .createTextOutput(JSON.stringify(errorResult))
        .setMimeType(ContentService.MimeType.JSON);
    }
  }
}

function initializeSheets(spreadsheet) {
  // Crear hoja de Configuraci√≥n
  var configSheet = spreadsheet.getSheetByName('Configuraci√≥n');
  if (!configSheet) {
    configSheet = spreadsheet.insertSheet('Configuraci√≥n');
    configSheet.getRange('A1:B1').setValues([['Par√°metro', 'Valor']]);
    configSheet.getRange('A2:B8').setValues([
      ['formato', 'todos'],
      ['puntosPorVictoria', '3'],
      ['puntosPorEmpate', '1'],
      ['numeroGrupos', '2'],
      ['clasificanPorGrupo', '2'],
      ['faseInicial', 'cuartos'],
      ['tercerPuesto', 'true']
    ]);
    configSheet.getRange('A1:B1').setFontWeight('bold');
  }
  
  // Crear hoja de Parejas
  var parejasSheet = spreadsheet.getSheetByName('Parejas');
  if (!parejasSheet) {
    parejasSheet = spreadsheet.insertSheet('Parejas');
    parejasSheet.getRange('A1:E1').setValues([['ID', 'Jugador1', 'Jugador2', 'Nombre', 'Grupo']]);
    parejasSheet.getRange('A1:E1').setFontWeight('bold');
    parejasSheet.setFrozenRows(1);
  }
  
  // Crear hoja de Jornadas
  var jornadasSheet = spreadsheet.getSheetByName('Jornadas');
  if (!jornadasSheet) {
    jornadasSheet = spreadsheet.insertSheet('Jornadas');
    jornadasSheet.getRange('A1:F1').setValues([['ID', 'Numero', 'Nombre', 'Fecha', 'Grupo', 'Partidos']]);
    jornadasSheet.getRange('A1:F1').setFontWeight('bold');
    jornadasSheet.setFrozenRows(1);
  }
  
  // Crear hoja de Partidos
  var partidosSheet = spreadsheet.getSheetByName('Partidos');
  if (!partidosSheet) {
    partidosSheet = spreadsheet.insertSheet('Partidos');
    partidosSheet.getRange('A1:J1').setValues([
      ['ID', 'JornadaID', 'Fase', 'Fecha', 'Pista', 'Pareja1ID', 'Pareja2ID', 'Resultado1', 'Resultado2', 'GanadorID']
    ]);
    partidosSheet.getRange('A1:J1').setFontWeight('bold');
    partidosSheet.setFrozenRows(1);
  }
}

// === FUNCIONES DE CONFIGURACI√ìN ===
function getConfig(spreadsheet) {
  var sheet = spreadsheet.getSheetByName('Configuraci√≥n');
  var data = sheet.getRange('A2:B8').getValues();
  var config = {};
  
  data.forEach(function(row) {
    var key = row[0];
    var value = row[1];
    
    if (key === 'puntosPorVictoria' || key === 'puntosPorEmpate' || 
        key === 'numeroGrupos' || key === 'clasificanPorGrupo') {
      config[key] = parseInt(value);
    } else if (key === 'tercerPuesto') {
      config[key] = value === 'true';
    } else {
      config[key] = value;
    }
  });
  
  return {success: true, data: config};
}

function saveConfig(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Configuraci√≥n');
  
  var configData = [
    ['formato', e.parameter.formato],
    ['puntosPorVictoria', e.parameter.puntosPorVictoria],
    ['puntosPorEmpate', e.parameter.puntosPorEmpate],
    ['numeroGrupos', e.parameter.numeroGrupos],
    ['clasificanPorGrupo', e.parameter.clasificanPorGrupo],
    ['faseInicial', e.parameter.faseInicial],
    ['tercerPuesto', e.parameter.tercerPuesto]
  ];
  
  sheet.getRange('A2:B8').setValues(configData);
  return {success: true};
}

// === FUNCIONES DE PAREJAS ===
function getParejas(spreadsheet) {
  var sheet = spreadsheet.getSheetByName('Parejas');
  var data = sheet.getDataRange().getValues();
  var parejas = [];
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0]) {
      parejas.push({
        id: data[i][0].toString(),
        jugador1: data[i][1],
        jugador2: data[i][2],
        nombre: data[i][3],
        grupo: data[i][4]
      });
    }
  }
  
  return {success: true, data: parejas};
}

function addPareja(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Parejas');
  var id = new Date().getTime().toString();
  var jugador1 = e.parameter.jugador1;
  var jugador2 = e.parameter.jugador2;
  var nombre = e.parameter.nombre || (jugador1 + ' / ' + jugador2);
  
  sheet.appendRow([id, jugador1, jugador2, nombre, '']);
  
  return {success: true, id: id};
}

function deletePareja(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Parejas');
  var id = e.parameter.id;
  var data = sheet.getDataRange().getValues();
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0].toString() === id) {
      sheet.deleteRow(i + 1);
      break;
    }
  }
  
  // Tambi√©n eliminar partidos de esta pareja
  var partidosSheet = spreadsheet.getSheetByName('Partidos');
  var partidosData = partidosSheet.getDataRange().getValues();
  
  for (var i = partidosData.length - 1; i >= 1; i--) {
    if (partidosData[i][5] === id || partidosData[i][6] === id) {
      partidosSheet.deleteRow(i + 1);
    }
  }
  
  return {success: true};
}

// === FUNCIONES DE JORNADAS ===
function getJornadas(spreadsheet) {
  var sheet = spreadsheet.getSheetByName('Jornadas');
  var data = sheet.getDataRange().getValues();
  var jornadas = [];
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0]) {
      var partidos = [];
      try {
        if (data[i][5]) {
          partidos = JSON.parse(data[i][5]);
        }
      } catch(e) {}
      
      jornadas.push({
        id: data[i][0].toString(),
        numero: data[i][1],
        nombre: data[i][2],
        fecha: data[i][3],
        grupo: data[i][4],
        partidos: partidos
      });
    }
  }
  
  return {success: true, data: jornadas};
}

function addJornada(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Jornadas');
  var id = new Date().getTime().toString();
  var numero = sheet.getLastRow();
  var nombre = e.parameter.nombre;
  
  sheet.appendRow([id, numero, nombre, '', '', '[]']);
  
  return {success: true, id: id};
}

function deleteJornada(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Jornadas');
  var id = e.parameter.id;
  var data = sheet.getDataRange().getValues();
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0].toString() === id) {
      sheet.deleteRow(i + 1);
      break;
    }
  }
  
  return {success: true};
}

function generarJornadas(spreadsheet, e) {
  var configResult = getConfig(spreadsheet);
  var config = configResult.data;
  var parejasResult = getParejas(spreadsheet);
  var parejas = parejasResult.data;
  
  var jornadasSheet = spreadsheet.getSheetByName('Jornadas');
  
  // Limpiar jornadas existentes
  if (jornadasSheet.getLastRow() > 1) {
    jornadasSheet.deleteRows(2, jornadasSheet.getLastRow() - 1);
  }
  
  if (config.formato === 'todos') {
    // Round-robin para todos contra todos
    var n = parejas.length;
    var rounds = n % 2 === 0 ? n - 1 : n;
    
    for (var round = 0; round < rounds; round++) {
      var jornadaPartidos = [];
      
      for (var i = 0; i < n / 2; i++) {
        var home = (round + i) % (n - 1);
        var away = (n - 1 - i + round) % (n - 1);
        
        if (i === 0 && n % 2 === 0) {
          away = n - 1;
        }
        
        if (home !== away && home < parejas.length && away < parejas.length) {
          jornadaPartidos.push({
            pareja1: parejas[home],
            pareja2: parejas[away]
          });
        }
      }
      
      var jornadaId = new Date().getTime() + round;
      jornadasSheet.appendRow([
        jornadaId,
        round + 1,
        'Jornada ' + (round + 1),
        '',
        '',
        JSON.stringify(jornadaPartidos)
      ]);
    }
  } else if (config.formato === 'grupos') {
    // Asignar grupos
    var parejasSheet = spreadsheet.getSheetByName('Parejas');
    var parejasPorGrupo = Math.ceil(parejas.length / config.numeroGrupos);
    
    // Mezclar parejas aleatoriamente
    var parejasAleatorias = parejas.slice();
    for (var i = parejasAleatorias.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = parejasAleatorias[i];
      parejasAleatorias[i] = parejasAleatorias[j];
      parejasAleatorias[j] = temp;
    }
    
    // Asignar grupos y actualizar
    for (var i = 0; i < parejasAleatorias.length; i++) {
      var grupoIndex = Math.floor(i / parejasPorGrupo);
      var grupo = String.fromCharCode(65 + grupoIndex);
      parejasAleatorias[i].grupo = grupo;
      
      // Actualizar en la hoja
      var data = parejasSheet.getDataRange().getValues();
      for (var j = 1; j < data.length; j++) {
        if (data[j][0].toString() === parejasAleatorias[i].id) {
          parejasSheet.getRange(j + 1, 5).setValue(grupo);
          break;
        }
      }
    }
    
    // Generar jornadas por grupo
    var jornadaCount = 0;
    for (var g = 0; g < config.numeroGrupos; g++) {
      var grupoLetra = String.fromCharCode(65 + g);
      var parejasGrupo = parejasAleatorias.filter(function(p) { return p.grupo === grupoLetra; });
      
      if (parejasGrupo.length > 1) {
        var n = parejasGrupo.length;
        var rounds = n % 2 === 0 ? n - 1 : n;
        
        for (var round = 0; round < rounds; round++) {
          var jornadaPartidos = [];
          
          for (var i = 0; i < n / 2; i++) {
            var home = (round + i) % (n - 1);
            var away = (n - 1 - i + round) % (n - 1);
            
            if (i === 0 && n % 2 === 0) {
              away = n - 1;
            }
            
            if (home !== away && home < parejasGrupo.length && away < parejasGrupo.length) {
              jornadaPartidos.push({
                pareja1: parejasGrupo[home],
                pareja2: parejasGrupo[away],
                grupo: grupoLetra
              });
            }
          }
          
          if (jornadaPartidos.length > 0) {
            jornadaCount++;
            var jornadaId = new Date().getTime() + jornadaCount;
            jornadasSheet.appendRow([
              jornadaId,
              jornadaCount,
              'Grupo ' + grupoLetra + ' - Jornada ' + (round + 1),
              '',
              grupoLetra,
              JSON.stringify(jornadaPartidos)
            ]);
          }
        }
      }
    }
  }
  
  return {success: true, message: 'Jornadas generadas correctamente'};
}

// === FUNCIONES DE PARTIDOS ===
function getPartidos(spreadsheet) {
  var sheet = spreadsheet.getSheetByName('Partidos');
  var data = sheet.getDataRange().getValues();
  var partidos = [];
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0]) {
      partidos.push({
        id: data[i][0].toString(),
        jornadaId: data[i][1] ? data[i][1].toString() : null,
        fase: data[i][2],
        fecha: data[i][3],
        pista: data[i][4],
        pareja1Id: data[i][5],
        pareja2Id: data[i][6],
        resultado1: data[i][7],
        resultado2: data[i][8],
        ganadorId: data[i][9] ? data[i][9].toString() : null
      });
    }
  }
  
  return {success: true, data: partidos};
}

function addPartido(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Partidos');
  var id = new Date().getTime().toString();
  
  sheet.appendRow([
    id,
    e.parameter.jornadaId || '',
    e.parameter.fase,
    e.parameter.fecha || '',
    e.parameter.pista || '',
    e.parameter.pareja1Id,
    e.parameter.pareja2Id,
    e.parameter.resultado1 || '',
    e.parameter.resultado2 || '',
    e.parameter.ganadorId || ''
  ]);
  
  return {success: true, id: id};
}

function updatePartido(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Partidos');
  var id = e.parameter.id;
  var data = sheet.getDataRange().getValues();
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0].toString() === id) {
      sheet.getRange(i + 1, 2, 1, 9).setValues([[
        e.parameter.jornadaId || '',
        e.parameter.fase,
        e.parameter.fecha || '',
        e.parameter.pista || '',
        e.parameter.pareja1Id,
        e.parameter.pareja2Id,
        e.parameter.resultado1 || '',
        e.parameter.resultado2 || '',
        e.parameter.ganadorId || ''
      ]]);
      break;
    }
  }
  
  return {success: true};
}

function deletePartido(spreadsheet, e) {
  var sheet = spreadsheet.getSheetByName('Partidos');
  var id = e.parameter.id;
  var data = sheet.getDataRange().getValues();
  
  for (var i = 1; i < data.length; i++) {
    if (data[i][0].toString() === id) {
      sheet.deleteRow(i + 1);
      break;
    }
  }
  
  return {success: true};
}</code></pre>

            <ol start="4">
                <li>Guarda el proyecto con un nombre (ej: "PadelCup2-GestionTorneo")</li>
                <li>Haz clic en <strong>Implementar ‚Üí Nueva implementaci√≥n</strong></li>
                <li>Configuraci√≥n:
                    <ul>
                        <li>Tipo: <strong>Aplicaci√≥n web</strong></li>
                        <li>Ejecutar como: <strong>Yo</strong></li>
                        <li>Acceso: <strong>Cualquier persona</strong></li>
                    </ul>
                </li>
                <li>Haz clic en <strong>Implementar</strong></li>
                <li><strong>IMPORTANTE:</strong> Autoriza todos los permisos cuando te lo solicite</li>
                <li>Copia la URL de la aplicaci√≥n web que te proporciona</li>
            </ol>
            
            <div class="form-group">
                <label for="scriptUrl">URL de la aplicaci√≥n web de Google Apps Script:</label>
                <input type="text" id="scriptUrl" placeholder="https://script.google.com/macros/s/.../exec" style="font-size: 14px;">
            </div>
            
            <button onclick="conectarGoogleSheets()" class="btn-success">üîó Conectar con Google Sheets</button>
            <button onclick="probarConexion()" style="background-color: #17a2b8; margin-left: 10px;">üß™ Probar Conexi√≥n</button>
        </div>

        <!-- Contenido principal (oculto hasta conectar) -->
        <div id="mainContent" style="display: none;">
            <!-- Los tabs y contenido ir√°n aqu√≠, simplificado por espacio -->
            <p class="loading">Conectando con Google Sheets...</p>
        </div>

        <div class="footer">
            <p>Premium PadelCup 2.0 ¬© 2024 - Desarrollado por <a href="https://ecav.com.py" target="_blank" class="sponsor-link">ECAV.com.py</a></p>
        </div>
    </div>

    <script>
        // Variables globales
        let scriptUrl = '';
        let configuracion = {};
        let parejas = [];
        let jornadas = [];
        let partidos = [];
        let callbackCounter = 0;

        // Funci√≥n para hacer llamadas JSONP
        function jsonpRequest(url, params = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonpCallback' + (callbackCounter++);
                const script = document.createElement('script');
                
                // Definir callback global
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    resolve(data);
                };
                
                // Configurar timeout
                const timeout = setTimeout(() => {
                    delete window[callbackName];
                    if (document.body.contains(script)) {
                        document.body.removeChild(script);
                    }
                    reject(new Error('Timeout en la petici√≥n'));
                }, 15000);
                
                // Construir URL con par√°metros
                const queryParams = new URLSearchParams(params);
                queryParams.append('callback', callbackName);
                const fullUrl = url + '?' + queryParams.toString();
                
                // Configurar y agregar script
                script.src = fullUrl;
                script.onerror = () => {
                    clearTimeout(timeout);
                    delete window[callbackName];
                    reject(new Error('Error al cargar el script'));
                };
                
                document.body.appendChild(script);
            });
        }

        // Probar conexi√≥n
        async function probarConexion() {
            const url = document.getElementById('scriptUrl').value.trim();
            if (!url) {
                alert('Por favor, ingresa la URL de Google Apps Script');
                return;
            }

            try {
                const result = await jsonpRequest(url, { action: 'test' });
                
                if (result.success) {
                    alert('‚úÖ ' + (result.message || 'Conexi√≥n exitosa'));
                } else {
                    alert('‚ùå Error: ' + (result.error || 'Error desconocido'));
                }
            } catch (error) {
                alert('‚ùå Error de conexi√≥n: ' + error.message);
            }
        }

        // Conectar con Google Sheets
        async function conectarGoogleSheets() {
            const url = document.getElementById('scriptUrl').value.trim();
            if (!url) {
                alert('Por favor, ingresa la URL de Google Apps Script');
                return;
            }

            scriptUrl = url;
            localStorage.setItem('padelcup2_scriptUrl', scriptUrl);
            
            try {
                // Mostrar mensaje de carga
                document.getElementById('setupSection').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('mainContent').innerHTML = '<p class="loading">Conectando con Google Sheets...</p>';
                
                // Cargar configuraci√≥n
                const configResult = await jsonpRequest(scriptUrl, { action: 'getConfig' });
                if (configResult.success) {
                    configuracion = configResult.data;
                }
                
                // Actualizar estado
                document.getElementById('connectionStatus').textContent = 'Conectado';
                document.getElementById('connectionStatus').className = 'connection-status connected';
                
                // Cargar interfaz completa
                cargarInterfazCompleta();
                
            } catch (error) {
                alert('Error al conectar: ' + error.message);
                document.getElementById('setupSection').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
            }
        }

        // Cargar interfaz completa
        async function cargarInterfazCompleta() {
            document.getElementById('mainContent').innerHTML = `
                <div class="tabs">
                    <div class="tab active" onclick="showTab('configuracion')">‚öôÔ∏è Configuraci√≥n</div>
                    <div class="tab" onclick="showTab('parejas')">üë• Parejas</div>
                    <div class="tab" onclick="showTab('jornadas')">üìÖ Jornadas</div>
                    <div class="tab" onclick="showTab('partidos')">üéæ Partidos</div>
                    <div class="tab" onclick="showTab('ranking')">üèÖ Ranking</div>
                </div>

                <!-- Tab de Configuraci√≥n -->
                <div id="configuracion" class="tab-content active">
                    <div class="section">
                        <h2>‚öôÔ∏è Configuraci√≥n del Torneo</h2>
                        
                        <div class="form-group">
                            <label for="formatoTorneo">Formato del Torneo:</label>
                            <select id="formatoTorneo" onchange="cambiarFormato()">
                                <option value="todos">Todos contra todos (Liga)</option>
                                <option value="grupos">Fase de grupos + Eliminatorias</option>
                                <option value="eliminacion">Eliminaci√≥n directa</option>
                            </select>
                        </div>

                        <div id="configTodos" class="formato-config">
                            <div class="info-box">
                                <strong>Liga - Todos contra todos:</strong> Cada pareja juega contra todas las dem√°s. 
                                El ganador se determina por puntos totales.
                            </div>
                            <div class="form-group">
                                <label for="puntosPorVictoria">Puntos por victoria:</label>
                                <input type="number" id="puntosPorVictoria" value="3" min="1">
                            </div>
                            <div class="form-group">
                                <label for="puntosPorEmpate">Puntos por empate (si aplica):</label>
                                <input type="number" id="puntosPorEmpate" value="1" min="0">
                            </div>
                        </div>

                        <div id="configGrupos" class="formato-config" style="display: none;">
                            <div class="info-box">
                                <strong>Fase de grupos:</strong> Las parejas se dividen en grupos. Los mejores de cada grupo 
                                avanzan a la fase eliminatoria.
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="numeroGrupos">N√∫mero de grupos:</label>
                                    <select id="numeroGrupos">
                                        <option value="2">2 grupos</option>
                                        <option value="4">4 grupos</option>
                                        <option value="8">8 grupos</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="clasificanPorGrupo">Clasifican por grupo:</label>
                                    <select id="clasificanPorGrupo">
                                        <option value="1">1 pareja</option>
                                        <option value="2">2 parejas</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div id="configEliminacion" class="formato-config" style="display: none;">
                            <div class="info-box">
                                <strong>Eliminaci√≥n directa:</strong> Formato de torneo con eliminaci√≥n simple. 
                                El perdedor de cada partido queda eliminado.
                            </div>
                            <div class="form-group">
                                <label for="faseInicial">Fase inicial:</label>
                                <select id="faseInicial">
                                    <option value="final">Final (2 parejas)</option>
                                    <option value="semifinal">Semifinales (4 parejas)</option>
                                    <option value="cuartos">Cuartos de final (8 parejas)</option>
                                    <option value="octavos">Octavos de final (16 parejas)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="tercerPuesto" checked>
                                Partido por el tercer puesto
                            </label>
                        </div>

                        <button onclick="guardarConfiguracion()" class="btn-success">
                            üíæ Guardar Configuraci√≥n
                        </button>
                    </div>
                </div>

                <!-- Tab de Parejas -->
                <div id="parejas" class="tab-content">
                    <div class="section">
                        <h2>üë• Registro de Parejas</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jugador1">Jugador 1:</label>
                                <input type="text" id="jugador1" placeholder="Nombre del jugador 1">
                            </div>
                            <div class="form-group">
                                <label for="jugador2">Jugador 2:</label>
                                <input type="text" id="jugador2" placeholder="Nombre del jugador 2">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nombrePareja">Nombre de la pareja (opcional):</label>
                            <input type="text" id="nombrePareja" placeholder="Ej: Los Invencibles">
                        </div>
                        <button onclick="agregarPareja()">‚ûï Agregar Pareja</button>

                        <h3 style="margin-top: 30px;">Parejas Registradas</h3>
                        <div id="listaParejas" class="loading">Cargando parejas...</div>
                    </div>
                </div>

                <!-- Tab de Jornadas -->
                <div id="jornadas" class="tab-content">
                    <div class="section">
                        <h2>üìÖ Gesti√≥n de Jornadas</h2>
                        
                        <div class="form-group">
                            <button onclick="generarJornadas()" class="btn-success">
                                üé≤ Generar Jornadas Autom√°ticamente
                            </button>
                            <button onclick="agregarJornada()" class="btn-secondary">
                                ‚ûï Agregar Jornada Manual
                            </button>
                        </div>

                        <div id="listaJornadas" class="loading">Cargando jornadas...</div>
                    </div>
                </div>

                <!-- Tab de Partidos -->
                <div id="partidos" class="tab-content">
                    <div class="section">
                        <h2>üéæ Registro de Partidos</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="jornada">Jornada:</label>
                                <select id="jornada">
                                    <option value="">Selecciona una jornada</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fase">Fase:</label>
                                <select id="fase">
                                    <option value="grupos">Fase de grupos</option>
                                    <option value="octavos">Octavos de final</option>
                                    <option value="cuartos">Cuartos de final</option>
                                    <option value="semifinal">Semifinal</option>
                                    <option value="final">Final</option>
                                    <option value="tercero">Tercer puesto</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="pareja1">Pareja 1:</label>
                                <select id="pareja1"></select>
                            </div>
                            <div class="form-group">
                                <label for="pareja2">Pareja 2:</label>
                                <select id="pareja2"></select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="fecha">Fecha y hora:</label>
                                <input type="datetime-local" id="fecha">
                            </div>
                            <div class="form-group">
                                <label for="pista">Pista:</label>
                                <input type="text" id="pista" placeholder="Ej: Pista 1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="resultado1">Resultado Pareja 1:</label>
                                <input type="text" id="resultado1" placeholder="Ej: 6-4 7-5">
                            </div>
                            <div class="form-group">
                                <label for="resultado2">Resultado Pareja 2:</label>
                                <input type="text" id="resultado2" placeholder="Ej: 4-6 5-7">
                            </div>
                        </div>
                        <button onclick="registrarPartido()">üíæ Registrar Partido</button>

                        <h3 style="margin-top: 30px;">Historial de Partidos</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Fase</th>
                                    <th>Pareja 1</th>
                                    <th>Resultado</th>
                                    <th>Pareja 2</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="listaPartidos">
                                <tr><td colspan="6" class="loading">Cargando partidos...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab de Ranking -->
                <div id="ranking" class="tab-content">
                    <div class="section">
                        <h2>üèÖ Ranking Individual</h2>
                        <div id="rankingIndividual" class="loading">Calculando ranking...</div>
                    </div>

                    <div class="section">
                        <h2>üéØ Ranking por Parejas</h2>
                        <div id="rankingParejas" class="loading">Calculando ranking...</div>
                    </div>
                </div>
            `;

            // Cargar configuraci√≥n
            document.getElementById('formatoTorneo').value = configuracion.formato || 'todos';
            document.getElementById('puntosPorVictoria').value = configuracion.puntosPorVictoria || 3;
            document.getElementById('puntosPorEmpate').value = configuracion.puntosPorEmpate || 1;
            document.getElementById('numeroGrupos').value = configuracion.numeroGrupos || 2;
            document.getElementById('clasificanPorGrupo').value = configuracion.clasificanPorGrupo || 2;
            document.getElementById('faseInicial').value = configuracion.faseInicial || 'cuartos';
            document.getElementById('tercerPuesto').checked = configuracion.tercerPuesto !== false;

            cambiarFormato();
            
            // Cargar datos
            await cargarTodosLosDatos();
        }

        // Inicializar al cargar
        window.onload = function() {
            // Intentar cargar URL guardada
            const savedUrl = localStorage.getItem('padelcup2_scriptUrl');
            if (savedUrl) {
                document.getElementById('scriptUrl').value = savedUrl;
            }
        };

        // === FUNCIONES DE LA APLICACI√ìN ===

        // Mostrar tab
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            contents.forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // Cambiar formato del torneo
        function cambiarFormato() {
            const formato = document.getElementById('formatoTorneo').value;
            document.querySelectorAll('.formato-config').forEach(el => {
                el.style.display = 'none';
            });

            if (formato === 'todos') {
                document.getElementById('configTodos').style.display = 'block';
            } else if (formato === 'grupos') {
                document.getElementById('configGrupos').style.display = 'block';
            } else if (formato === 'eliminacion') {
                document.getElementById('configEliminacion').style.display = 'block';
            }
        }

        // Guardar configuraci√≥n
        async function guardarConfiguracion() {
            const params = {
                action: 'saveConfig',
                formato: document.getElementById('formatoTorneo').value,
                puntosPorVictoria: document.getElementById('puntosPorVictoria').value,
                puntosPorEmpate: document.getElementById('puntosPorEmpate').value,
                numeroGrupos: document.getElementById('numeroGrupos').value,
                clasificanPorGrupo: document.getElementById('clasificanPorGrupo').value,
                faseInicial: document.getElementById('faseInicial').value,
                tercerPuesto: document.getElementById('tercerPuesto').checked
            };

            try {
                const result = await jsonpRequest(scriptUrl, params);
                if (result.success) {
                    mostrarMensaje('‚úÖ Configuraci√≥n guardada correctamente', 'success');
                    
                    // Actualizar configuraci√≥n local
                    configuracion = {
                        formato: params.formato,
                        puntosPorVictoria: parseInt(params.puntosPorVictoria),
                        puntosPorEmpate: parseInt(params.puntosPorEmpate),
                        numeroGrupos: parseInt(params.numeroGrupos),
                        clasificanPorGrupo: parseInt(params.clasificanPorGrupo),
                        faseInicial: params.faseInicial,
                        tercerPuesto: params.tercerPuesto
                    };
                }
            } catch (error) {
                mostrarMensaje('Error al guardar configuraci√≥n: ' + error.message, 'error');
            }
        }

        // Cargar todos los datos
        async function cargarTodosLosDatos() {
            try {
                // Cargar parejas
                const parejasResult = await jsonpRequest(scriptUrl, { action: 'getParejas' });
                if (parejasResult.success) {
                    parejas = parejasResult.data || [];
                    actualizarListaParejas();
                    actualizarSelectsParejas();
                }

                // Cargar jornadas
                const jornadasResult = await jsonpRequest(scriptUrl, { action: 'getJornadas' });
                if (jornadasResult.success) {
                    jornadas = jornadasResult.data || [];
                    actualizarListaJornadas();
                    actualizarSelectJornadas();
                }

                // Cargar partidos
                const partidosResult = await jsonpRequest(scriptUrl, { action: 'getPartidos' });
                if (partidosResult.success) {
                    partidos = partidosResult.data || [];
                    actualizarTablaPartidos();
                    actualizarRanking();
                }
            } catch (error) {
                console.error('Error cargando datos:', error);
            }
        }

        // Agregar pareja
        async function agregarPareja() {
            const jugador1 = document.getElementById('jugador1').value.trim();
            const jugador2 = document.getElementById('jugador2').value.trim();
            const nombrePareja = document.getElementById('nombrePareja').value.trim();

            if (!jugador1 || !jugador2) {
                alert('Por favor, ingresa los nombres de ambos jugadores');
                return;
            }

            try {
                const params = {
                    action: 'addPareja',
                    jugador1: jugador1,
                    jugador2: jugador2,
                    nombre: nombrePareja
                };

                const result = await jsonpRequest(scriptUrl, params);
                
                if (result.success) {
                    document.getElementById('jugador1').value = '';
                    document.getElementById('jugador2').value = '';
                    document.getElementById('nombrePareja').value = '';
                    
                    mostrarMensaje('‚úÖ Pareja agregada correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al agregar pareja: ' + error.message, 'error');
            }
        }

        // Actualizar lista de parejas
        function actualizarListaParejas() {
            const lista = document.getElementById('listaParejas');
            
            if (parejas.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666;">No hay parejas registradas</p>';
                return;
            }

            let html = '<table><thead><tr><th>Nombre</th><th>Jugadores</th>';
            if (configuracion.formato === 'grupos') {
                html += '<th>Grupo</th>';
            }
            html += '<th>Acciones</th></tr></thead><tbody>';

            parejas.forEach(pareja => {
                html += `<tr>
                    <td><strong>${pareja.nombre}</strong></td>
                    <td>${pareja.jugador1} / ${pareja.jugador2}</td>`;
                
                if (configuracion.formato === 'grupos') {
                    html += `<td>${pareja.grupo || '-'}</td>`;
                }
                
                html += `<td>
                        <button onclick="eliminarPareja('${pareja.id}')" class="btn-danger">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>`;
            });

            html += '</tbody></table>';
            lista.innerHTML = html;
        }

        // Actualizar selects de parejas
        function actualizarSelectsParejas() {
            const selects = ['pareja1', 'pareja2'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecciona una pareja</option>';
                    parejas.forEach(pareja => {
                        select.innerHTML += `<option value="${pareja.id}">${pareja.nombre}</option>`;
                    });
                }
            });
        }

        // Eliminar pareja
        async function eliminarPareja(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta pareja? Se eliminar√°n tambi√©n sus partidos.')) {
                return;
            }

            try {
                const result = await jsonpRequest(scriptUrl, { action: 'deletePareja', id: id });
                
                if (result.success) {
                    mostrarMensaje('‚úÖ Pareja eliminada correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al eliminar pareja: ' + error.message, 'error');
            }
        }

        // Generar jornadas
        async function generarJornadas() {
            if (parejas.length < 2) {
                alert('Necesitas al menos 2 parejas para generar jornadas');
                return;
            }

            if (!confirm('¬øDeseas generar las jornadas autom√°ticamente? Esto eliminar√° las jornadas existentes.')) {
                return;
            }

            try {
                mostrarMensaje('Generando jornadas...', 'info');
                
                const result = await jsonpRequest(scriptUrl, { action: 'generarJornadas' });
                
                if (result.success) {
                    mostrarMensaje('‚úÖ Jornadas generadas correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al generar jornadas: ' + error.message, 'error');
            }
        }

        // Agregar jornada manual
        async function agregarJornada() {
            const nombre = prompt('Nombre de la jornada:');
            if (!nombre) return;

            try {
                const result = await jsonpRequest(scriptUrl, { 
                    action: 'addJornada', 
                    nombre: nombre 
                });
                
                if (result.success) {
                    mostrarMensaje('‚úÖ Jornada agregada correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al agregar jornada: ' + error.message, 'error');
            }
        }

        // Actualizar lista de jornadas
        function actualizarListaJornadas() {
            const lista = document.getElementById('listaJornadas');
            
            if (jornadas.length === 0) {
                lista.innerHTML = '<p style="text-align: center; color: #666;">No hay jornadas programadas</p>';
                return;
            }

            let html = '<table><thead><tr><th>Jornada</th><th>Partidos</th><th>Acciones</th></tr></thead><tbody>';
            
            jornadas.forEach(jornada => {
                const numPartidos = jornada.partidos ? jornada.partidos.length : 0;
                html += `<tr>
                    <td><strong>${jornada.nombre}</strong></td>
                    <td>${numPartidos} partidos</td>
                    <td>
                        <button onclick="eliminarJornada('${jornada.id}')" class="btn-danger">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>`;
                
                // Mostrar partidos de la jornada
                if (jornada.partidos && jornada.partidos.length > 0) {
                    jornada.partidos.forEach(partido => {
                        html += `<tr style="background-color: #f9f9f9;">
                            <td colspan="3" style="padding-left: 30px;">
                                ${partido.pareja1.nombre} vs ${partido.pareja2.nombre}
                            </td>
                        </tr>`;
                    });
                }
            });
            
            html += '</tbody></table>';
            lista.innerHTML = html;
        }

        // Actualizar select de jornadas
        function actualizarSelectJornadas() {
            const select = document.getElementById('jornada');
            if (select) {
                select.innerHTML = '<option value="">Selecciona una jornada</option>';
                jornadas.forEach(jornada => {
                    select.innerHTML += `<option value="${jornada.id}">${jornada.nombre}</option>`;
                });
            }
        }

        // Eliminar jornada
        async function eliminarJornada(id) {
            if (!confirm('¬øEst√°s seguro de eliminar esta jornada?')) {
                return;
            }

            try {
                const result = await jsonpRequest(scriptUrl, { action: 'deleteJornada', id: id });
                
                if (result.success) {
                    mostrarMensaje('‚úÖ Jornada eliminada correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al eliminar jornada: ' + error.message, 'error');
            }
        }

        // Registrar partido
        async function registrarPartido() {
            const jornadaId = document.getElementById('jornada').value;
            const fase = document.getElementById('fase').value;
            const pareja1Id = document.getElementById('pareja1').value;
            const pareja2Id = document.getElementById('pareja2').value;
            const fecha = document.getElementById('fecha').value;
            const pista = document.getElementById('pista').value;
            const resultado1 = document.getElementById('resultado1').value.trim();
            const resultado2 = document.getElementById('resultado2').value.trim();

            if (!pareja1Id || !pareja2Id) {
                alert('Por favor, selecciona ambas parejas');
                return;
            }

            if (pareja1Id === pareja2Id) {
                alert('Las parejas deben ser diferentes');
                return;
            }

            let ganadorId = '';
            if (resultado1 && resultado2) {
                const sets1 = contarSetsGanados(resultado1);
                const sets2 = contarSetsGanados(resultado2);
                ganadorId = sets1 > sets2 ? pareja1Id : pareja2Id;
            }

            try {
                const params = {
                    action: 'addPartido',
                    jornadaId: jornadaId,
                    fase: fase,
                    fecha: fecha,
                    pista: pista,
                    pareja1Id: pareja1Id,
                    pareja2Id: pareja2Id,
                    resultado1: resultado1,
                    resultado2: resultado2,
                    ganadorId: ganadorId
                };

                const result = await jsonpRequest(scriptUrl, params);
                
                if (result.success) {
                    document.getElementById('fecha').value = '';
                    document.getElementById('pista').value = '';
                    document.getElementById('resultado1').value = '';
                    document.getElementById('resultado2').value = '';
                    
                    mostrarMensaje('‚úÖ Partido registrado correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al registrar partido: ' + error.message, 'error');
            }
        }

        // Contar sets ganados
        function contarSetsGanados(resultado) {
            const sets = resultado.split(' ');
            let setsGanados = 0;
            
            sets.forEach(set => {
                const games = set.split('-');
                if (games.length === 2 && parseInt(games[0]) > parseInt(games[1])) {
                    setsGanados++;
                }
            });
            
            return setsGanados;
        }

        // Actualizar tabla de partidos
        function actualizarTablaPartidos() {
            const tbody = document.getElementById('listaPartidos');
            
            if (partidos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No hay partidos registrados</td></tr>';
                return;
            }

            let html = '';
            partidos.forEach(partido => {
                const pareja1 = parejas.find(p => p.id === partido.pareja1Id);
                const pareja2 = parejas.find(p => p.id === partido.pareja2Id);
                
                if (!pareja1 || !pareja2) return;

                const esGanador1 = partido.ganadorId === pareja1.id;
                const esGanador2 = partido.ganadorId === pareja2.id;

                html += `<tr>
                    <td>${partido.fecha ? new Date(partido.fecha).toLocaleString('es-ES') : '-'}</td>
                    <td>${obtenerNombreFase(partido.fase)}</td>
                    <td class="${esGanador1 ? 'ganador' : ''}" style="${esGanador1 ? 'color: #28a745; font-weight: bold;' : ''}">
                        ${pareja1.nombre}
                    </td>
                    <td>${partido.resultado1 || '-'} | ${partido.resultado2 || '-'}</td>
                    <td class="${esGanador2 ? 'ganador' : ''}" style="${esGanador2 ? 'color: #28a745; font-weight: bold;' : ''}">
                        ${pareja2.nombre}
                    </td>
                    <td>
                        <button onclick="eliminarPartido('${partido.id}')" class="btn-danger">üóëÔ∏è</button>
                    </td>
                </tr>`;
            });

            tbody.innerHTML = html;
        }

        // Obtener nombre de fase
        function obtenerNombreFase(fase) {
            const fases = {
                'grupos': 'Grupos',
                'octavos': 'Octavos',
                'cuartos': 'Cuartos',
                'semifinal': 'Semifinal',
                'final': 'Final',
                'tercero': '3er Puesto'
            };
            return fases[fase] || fase;
        }

        // Eliminar partido
        async function eliminarPartido(id) {
            if (!confirm('¬øEst√°s seguro de eliminar este partido?')) {
                return;
            }

            try {
                const result = await jsonpRequest(scriptUrl, { action: 'deletePartido', id: id });
                
                if (result.success) {
                    mostrarMensaje('‚úÖ Partido eliminado correctamente', 'success');
                    await cargarTodosLosDatos();
                }
            } catch (error) {
                mostrarMensaje('Error al eliminar partido: ' + error.message, 'error');
            }
        }

        // Actualizar ranking
        function actualizarRanking() {
            actualizarRankingIndividual();
            actualizarRankingParejas();
        }

        // Actualizar ranking individual
        function actualizarRankingIndividual() {
            const jugadores = {};

            partidos.forEach(partido => {
                if (!partido.resultado1 || !partido.resultado2) return;

                const pareja1 = parejas.find(p => p.id === partido.pareja1Id);
                const pareja2 = parejas.find(p => p.id === partido.pareja2Id);
                
                if (!pareja1 || !pareja2) return;

                // Procesar jugadores de pareja 1
                [pareja1.jugador1, pareja1.jugador2].forEach(jugador => {
                    if (!jugadores[jugador]) {
                        jugadores[jugador] = { 
                            nombre: jugador, 
                            victorias: 0, 
                            derrotas: 0, 
                            partidos: 0
                        };
                    }
                    
                    jugadores[jugador].partidos++;
                    
                    if (partido.ganadorId === pareja1.id) {
                        jugadores[jugador].victorias++;
                    } else {
                        jugadores[jugador].derrotas++;
                    }
                });

                // Procesar jugadores de pareja 2
                [pareja2.jugador1, pareja2.jugador2].forEach(jugador => {
                    if (!jugadores[jugador]) {
                        jugadores[jugador] = { 
                            nombre: jugador, 
                            victorias: 0, 
                            derrotas: 0, 
                            partidos: 0
                        };
                    }
                    
                    jugadores[jugador].partidos++;
                    
                    if (partido.ganadorId === pareja2.id) {
                        jugadores[jugador].victorias++;
                    } else {
                        jugadores[jugador].derrotas++;
                    }
                });
            });

            const divRanking = document.getElementById('rankingIndividual');
            const rankingOrdenado = Object.values(jugadores)
                .sort((a, b) => b.victorias - a.victorias || b.partidos - a.partidos);

            if (rankingOrdenado.length === 0) {
                divRanking.innerHTML = '<p style="text-align: center; color: #666;">No hay datos para mostrar el ranking</p>';
                return;
            }

            let html = '';
            rankingOrdenado.forEach((jugador, index) => {
                const porcentaje = jugador.partidos > 0 
                    ? Math.round((jugador.victorias / jugador.partidos) * 100) 
                    : 0;
                const positionClass = index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : '';
                
                html += `<div class="ranking-card">
                    <div class="ranking-position ${positionClass}">#${index + 1}</div>
                    <div style="flex-grow: 1;">
                        <div style="font-size: 1.2em; font-weight: 500;">${jugador.nombre}</div>
                        <div style="color: #666; font-size: 0.9em;">
                            ${jugador.victorias}V - ${jugador.derrotas}D (${porcentaje}%)
                        </div>
                    </div>
                </div>`;
            });

            divRanking.innerHTML = html;
        }

        // Actualizar ranking de parejas
        function actualizarRankingParejas() {
            const estadisticasParejas = {};

            partidos.forEach(partido => {
                if (!partido.resultado1 || !partido.resultado2) return;

                const pareja1 = parejas.find(p => p.id === partido.pareja1Id);
                const pareja2 = parejas.find(p => p.id === partido.pareja2Id);
                
                if (!pareja1 || !pareja2) return;

                // Procesar pareja 1
                if (!estadisticasParejas[pareja1.id]) {
                    estadisticasParejas[pareja1.id] = {
                        pareja: pareja1,
                        victorias: 0,
                        derrotas: 0,
                        puntos: 0
                    };
                }

                if (partido.ganadorId === pareja1.id) {
                    estadisticasParejas[pareja1.id].victorias++;
                    estadisticasParejas[pareja1.id].puntos += configuracion.puntosPorVictoria || 3;
                } else {
                    estadisticasParejas[pareja1.id].derrotas++;
                }

                // Procesar pareja 2
                if (!estadisticasParejas[pareja2.id]) {
                    estadisticasParejas[pareja2.id] = {
                        pareja: pareja2,
                        victorias: 0,
                        derrotas: 0,
                        puntos: 0
                    };
                }

                if (partido.ganadorId === pareja2.id) {
                    estadisticasParejas[pareja2.id].victorias++;
                    estadisticasParejas[pareja2.id].puntos += configuracion.puntosPorVictoria || 3;
                } else {
                    estadisticasParejas[pareja2.id].derrotas++;
                }
            });

            const divRanking = document.getElementById('rankingParejas');
            
            if (Object.keys(estadisticasParejas).length === 0) {
                divRanking.innerHTML = '<p style="text-align: center; color: #666;">No hay datos de parejas</p>';
                return;
            }

            let html = '<table><thead><tr><th>Pos</th><th>Pareja</th><th>PJ</th><th>PG</th><th>PP</th><th>Puntos</th></tr></thead><tbody>';
            
            const rankingOrdenado = Object.values(estadisticasParejas)
                .sort((a, b) => b.puntos - a.puntos || b.victorias - a.victorias);

            rankingOrdenado.forEach((stats, index) => {
                const totalPartidos = stats.victorias + stats.derrotas;
                html += `<tr>
                    <td><strong>${index + 1}</strong></td>
                    <td>${stats.pareja.nombre}</td>
                    <td>${totalPartidos}</td>
                    <td>${stats.victorias}</td>
                    <td>${stats.derrotas}</td>
                    <td><strong>${stats.puntos}</strong></td>
                </tr>`;
            });
            
            html += '</tbody></table>';
            divRanking.innerHTML = html;
        }

        // Mostrar mensaje
        function mostrarMensaje(mensaje, tipo) {
            const div = document.createElement('div');
            div.className = tipo === 'error' ? 'error' : tipo === 'success' ? 'success' : 'info-box';
            div.textContent = mensaje;
            div.style.position = 'fixed';
            div.style.top = '20px';
            div.style.left = '50%';
            div.style.transform = 'translateX(-50%)';
            div.style.zIndex = '2000';
            div.style.minWidth = '300px';
            div.style.textAlign = 'center';
            
            document.body.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 3000);
        }
    </script>
</body>
</html>
